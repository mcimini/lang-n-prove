Specification "sums". 

Define progresses : term -> prop by
	 progresses E := {value E} ;
	 progresses E := {error E} ;
	 progresses E := exists E', {step E E'}.

Theorem Error-types-all: forall E T1 T2, {typeOf E T1} -> {error E} -> {typeOf E T2}.
 intros Hyp1 Error. case Error. 

Theorem Canonical-form-sum: forall e, forall T1, forall T2, {typeOf e (sum T1 T2)} -> {value e} -> exists V1, e = (inl V1) /\ {value V1} \/ exists V1, e = (inr V1) /\ {value V1}. 
intros Main ValHyp.  case Main.  Minl: case ValHyp.  search.  Minr: case ValHyp.  search.  Mcase: case ValHyp. 


Theorem Progress-inl: forall ty, forall E1, {typeOf (inl E1) ty} -> progresses E1 -> progresses (inl E1). 
intros Main Prgs0.  ProgressHyp0: case Prgs0.  search.  search.  search. 


Theorem Progress-inr: forall ty, forall E1, {typeOf (inr E1) ty} -> progresses E1 -> progresses (inr E1). 
intros Main Prgs0.  ProgressHyp0: case Prgs0.  search.  search.  search. 


Theorem Progress-case: forall ty, forall E1, forall E2, forall E3, {typeOf (case E1 E2 E3) ty} -> progresses E1 -> progresses (case E1 E2 E3). 
intros Main Prgs0.  ProgressHyp0: case Prgs0.  Typing0: case Main.  Canonical: apply Canonical-form-sum to Typing0 ProgressHyp0.  case Canonical.  search.  search.  search.  search. 


Theorem Progress-thm: forall e, forall typ, {typeOf e typ} -> progresses e. 
IH0 : induction on 1. intros Main. Typing0: case Main.  apply IH0 to Typing0.  backchain Progress-inl.  apply IH0 to Typing0.  backchain Progress-inr.  apply IH0 to Typing0.  backchain Progress-case. 


Theorem Type-preservation: forall e1, forall e2, forall typ, {typeOf e1 typ} -> {step e1 e2} -> {typeOf e2 typ}. 
IH0 : induction on 1. intros Main Step. Typing0: case Main.  Minl: case Step.  apply IH0 to Typing0 Minl.  search.  backchain Error-types-all.  Minr: case Step.  apply IH0 to Typing0 Minr.  search.  backchain Error-types-all.  Mcase: case Step.  skip.  skip.  apply IH0 to Typing0 Mcase.  search.  backchain Error-types-all. 


